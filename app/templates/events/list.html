{% extends "base.html" %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>{{ title }}</h2>
    </div>
    <div class="card-body">
        <div id="event-list" class="event-grid"
             hx-get="{{ url_for('main.get_events', asset_id=asset.asset_id if asset else None, location_id=location.location_id if location else None) }}"
             hx-trigger="load"
             hx-swap="beforeend">
            <!-- Events will be loaded here -->
        </div>
    </div>
</div>

<style>
.event-grid {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.event-card {
    border: 1px solid var(--border-color);
    border-radius: 4px;
    padding: 1rem;
    background-color: var(--background-secondary);
}

.event-card .header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 0.5rem;
}

.event-card .title {
    margin: 0;
    color: var(--text-primary);
    font-size: 1.1rem;
}

.event-card .timestamp {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.event-card .type {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.8rem;
    margin-bottom: 0.5rem;
    background-color: var(--primary-light);
    color: var(--primary);
}

.event-card .description {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin: 0.5rem 0;
}

.event-card .meta {
    font-size: 0.8rem;
    color: var(--text-secondary);
}

.event-card .meta span {
    margin-right: 1rem;
}

.loading {
    opacity: 0.5;
    pointer-events: none;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const eventList = document.getElementById('event-list');
    let loading = false;
    
    // Intersection Observer for infinite scroll
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting && !loading) {
                const loadMore = entry.target.querySelector('[data-load-more]');
                if (loadMore) {
                    loading = true;
                    htmx.trigger(loadMore, 'click');
                }
            }
        });
    });
    
    // Observe the last event card
    function observeLastCard() {
        const cards = eventList.querySelectorAll('.event-card');
        if (cards.length > 0) {
            observer.observe(cards[cards.length - 1]);
        }
    }
    
    // Initial observation
    observeLastCard();
    
    // Re-observe after new content is loaded
    eventList.addEventListener('htmx:afterSwap', function() {
        loading = false;
        observeLastCard();
    });
});
</script>
{% endblock %} 