{% extends "maintenance/base.html" %}

{% block maintenance_title %}Maintenance Event #{{ maintenance_event.maintenance_number }}{% endblock %}

{% block maintenance_content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Maintenance Event #{{ maintenance_event.maintenance_number }}</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <div class="btn-group me-2">
            <a href="{{ url_for('maintenance.maintenance_events_edit', id=maintenance_event.id) }}" class="btn btn-primary">
                <i class="bi bi-pencil"></i> Edit
            </a>
            <a href="{{ url_for('maintenance.maintenance_events_list') }}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> Back to List
            </a>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <!-- Event Details -->
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Event Details</h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <dl class="row">
                            <dt class="col-sm-4">Title:</dt>
                            <dd class="col-sm-8">{{ maintenance_event.title }}</dd>
                            
                            <dt class="col-sm-4">Status:</dt>
                            <dd class="col-sm-8">
                                <span class="badge 
                                    {% if maintenance_event.maintenance_status == 'Created' %}bg-warning
                                    {% elif maintenance_event.maintenance_status == 'In Progress' %}bg-primary
                                    {% elif maintenance_event.maintenance_status == 'Completed' %}bg-success
                                    {% elif maintenance_event.maintenance_status == 'Cancelled' %}bg-secondary
                                    {% else %}bg-light text-dark{% endif %}">
                                    {{ maintenance_event.maintenance_status }}
                                </span>
                            </dd>
                            
                            <dt class="col-sm-4">Priority:</dt>
                            <dd class="col-sm-8">
                                <span class="badge 
                                    {% if maintenance_event.priority == 'High' %}bg-danger
                                    {% elif maintenance_event.priority == 'Medium' %}bg-warning
                                    {% else %}bg-info{% endif %}">
                                    {{ maintenance_event.priority }}
                                </span>
                            </dd>
                            
                            <dt class="col-sm-4">Asset:</dt>
                            <dd class="col-sm-8">
                                {% if maintenance_event.asset %}
                                    <a href="{{ url_for('core_assets.detail', asset_id=maintenance_event.asset.id) }}">
                                        {{ maintenance_event.asset.name }}
                                    </a>
                                {% else %}
                                    <span class="text-muted">Not assigned</span>
                                {% endif %}
                            </dd>
                        </dl>
                    </div>
                    <div class="col-md-6">
                        <dl class="row">
                            <dt class="col-sm-4">Scheduled Date:</dt>
                            <dd class="col-sm-8">
                                {% if maintenance_event.scheduled_date %}
                                    {{ maintenance_event.scheduled_date.strftime('%Y-%m-%d') }}
                                {% else %}
                                    <span class="text-muted">Not scheduled</span>
                                {% endif %}
                            </dd>
                            
                            <dt class="col-sm-4">Due Date:</dt>
                            <dd class="col-sm-8">
                                {% if maintenance_event.due_date %}
                                    {{ maintenance_event.due_date.strftime('%Y-%m-%d') }}
                                {% else %}
                                    <span class="text-muted">No due date</span>
                                {% endif %}
                            </dd>
                            
                            <dt class="col-sm-4">Assigned To:</dt>
                            <dd class="col-sm-8">
                                {% if maintenance_event.assigned_user %}
                                    {{ maintenance_event.assigned_user.name }}
                                {% else %}
                                    <span class="text-muted">Unassigned</span>
                                {% endif %}
                            </dd>
                            
                            <dt class="col-sm-4">Created By:</dt>
                            <dd class="col-sm-8">
                                {% if maintenance_event.created_by %}
                                    {{ maintenance_event.created_by.name }}
                                {% else %}
                                    <span class="text-muted">Unknown</span>
                                {% endif %}
                            </dd>
                        </dl>
                    </div>
                </div>
                
                {% if maintenance_event.description %}
                <div class="row mt-3">
                    <div class="col-12">
                        <dt>Description:</dt>
                        <dd>{{ maintenance_event.description|replace('\n', '<br>')|safe }}</dd>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <!-- Status Update -->
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Update Status</h6>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('maintenance.maintenance_events_update_status', id=maintenance_event.id) }}">
                    <div class="mb-3">
                        <label for="status" class="form-label">New Status</label>
                        <select class="form-select" id="status" name="status" required>
                            <option value="">Select Status</option>
                            <option value="Created" {% if maintenance_event.maintenance_status == 'Created' %}selected{% endif %}>Created</option>
                            <option value="In Progress" {% if maintenance_event.maintenance_status == 'In Progress' %}selected{% endif %}>In Progress</option>
                            <option value="Completed" {% if maintenance_event.maintenance_status == 'Completed' %}selected{% endif %}>Completed</option>
                            <option value="Cancelled" {% if maintenance_event.maintenance_status == 'Cancelled' %}selected{% endif %}>Cancelled</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="reason" class="form-label">Reason (Optional)</label>
                        <textarea class="form-control" id="reason" name="reason" rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Update Status</button>
                </form>
            </div>
        </div>
        
        <!-- Event History -->
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Event History</h6>
            </div>
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-4">Created:</dt>
                    <dd class="col-sm-8">{{ maintenance_event.created_date.strftime('%Y-%m-%d %H:%M') }}</dd>
                    
                    {% if maintenance_event.updated_date %}
                    <dt class="col-sm-4">Last Updated:</dt>
                    <dd class="col-sm-8">{{ maintenance_event.updated_date.strftime('%Y-%m-%d %H:%M') }}</dd>
                    {% endif %}
                    
                    {% if maintenance_event.completed_date %}
                    <dt class="col-sm-4">Completed:</dt>
                    <dd class="col-sm-8">{{ maintenance_event.completed_date.strftime('%Y-%m-%d %H:%M') }}</dd>
                    {% endif %}
                </dl>
            </div>
        </div>
    </div>
</div>
{% endblock %}
